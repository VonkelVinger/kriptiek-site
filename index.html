<!DOCTYPE html>
<html lang="af">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kriptiek</title>

  <!-- Favicon and App Icons -->
  <link rel="icon" href="/assets/favicon.ico?v=2" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png?v=3">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png?v=3">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png?v=3">
  <link rel="manifest" href="/assets/site.webmanifest?v=3">

  <!-- Social Share Image -->
  <meta property="og:image" content="https://www.kriptiek.com/assets/share-logo.png?v=1" />
  <meta name="twitter:image" content="https://www.kriptiek.com/assets/share-logo.png?v=1" />

  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet" />
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    :root { --tile-w: 164px; }
    body{font-family:'Montserrat',system-ui,-apple-system,Segoe UI,Roboto,Arial,sans-serif;background:#f8f5f2;color:#0f172a}
    .tile-grid{display:grid;grid-template-columns:repeat(2,minmax(0,1fr));gap:18px;justify-items:center}
    .tile{width:var(--tile-w);aspect-ratio:1/1;border-radius:18px;box-shadow:0 14px 28px rgba(0,0,0,.16);overflow:hidden;display:block;transform:translateZ(0)}
    .tile img{width:100%;height:100%;object-fit:cover;display:block;transition:transform .25s ease}
    .tile:hover img{transform:translateY(-2px) scale(1.02)}
    .card{background:#fff;border-radius:14px;box-shadow:0 10px 24px rgba(0,0,0,.10)}
    .hide{display:none !important}
  </style>
</head>
<body class="min-h-screen">
  <header class="pt-8 pb-2">
    <div class="max-w-xl mx-auto text-center">
      <h1 id="welcome" class="text-2xl md:text-3xl font-bold tracking-wide text-sky-800">WELKOM BY KRIPTIEK</h1>
      <p class="text-sm text-slate-600 mt-1">Tuiste van DILEMMA, BLITSTIEK en SLIMSTIEK.</p>
    </div>
  </header>

  <main class="max-w-xl mx-auto px-4 mt-6">
    <!-- Tiles grid -->
    <section class="tile-grid">
      <!-- Dilemma -->
      <a class="tile" href="/dilemma.html" aria-label="Speel Dilemma">
        <img src="/assets/DILEMMA_12SEP.png" alt="DILEMMA knoppie">
      </a>

      <!-- Blitstiek -->
      <a class="tile" href="/blitstiek.html" aria-label="Speel Blitstiek">
        <img src="/assets/BLITSTIEK_12SEP.png" alt="BLITSTIEK knoppie">
      </a>

      <!-- Slimstiek -->
      <a class="tile" href="/slimstiek.html" aria-label="Speel Slimstiek">
        <img src="/assets/S_SLIMSTIEK_12SEP.png" alt="SLIMSTIEK knoppie">
      </a>

      <!-- Argief (Dilemma) -->
      <a class="tile" href="/dilemma-argief.html" aria-label="Dilemma-argief">
        <img src="/assets/ARGIEF_12SEP.png" alt="ARGIEF knoppie">
      </a>

      <!-- My Profiel -->
      <a class="tile" id="profileTile" href="/my-profiel.html" aria-label="My Profiel">
        <img src="/assets/MYPROFIEL_12SEP.png" alt="MY PROFIEL knoppie">
      </a>

      <!-- NEW: KRY DIE APP (replaces GESELS on home) -->
      <a class="tile" id="appTile" href="/kry-die-app.html" aria-label="Kry die Kriptiek-app">
        <img src="/assets/KRYDIEAPP_12SEP.png" alt="KRY DIE APP knoppie">
      </a>
    </section>

    <!-- Donation card -->
    <section class="card mt-6 p-4 text-center">
      <a href="/steun.html" class="inline-flex items-center justify-center px-4 py-2 rounded-full text-white bg-amber-500 hover:bg-amber-600 font-bold shadow">
        <span class="mr-2">ðŸŸ¨</span> Hou Kriptiek gratis
      </a>
      <p class="text-slate-600 text-sm mt-2">
        Klik bo as jy Kriptiek.com finansieel kan ondersteun. Daarsonder sal ons nie kan voortbestaan nie!
      </p>
    </section>

    <!-- Cookie consent -->
    <div id="cookieBanner" class="card mt-6 p-4 flex items-center justify-between gap-3">
      <div class="text-sm text-slate-700">
        Ons gebruik noodsaaklike koekies vir aanmelding en speldata. Deur voort te gaan, stem jy in.
      </div>
      <button id="cookieBtn" class="px-3 py-1.5 rounded-md bg-sky-700 hover:bg-sky-800 text-white text-sm font-bold">
        Verstaan
      </button>
    </div>
  </main>

  <!-- Auth + UI logic + PWA install -->
  <script type="module">
    // --- Welcome line (uppercase name for signed-in users) ---
    const welcomeEl = document.getElementById('welcome');
    const up = s => (s || '').toString().toUpperCase();
    function setWelcome(name){
      if(name){ welcomeEl.textContent = 'WELKOM TERUG, ' + up(name); }
      else { welcomeEl.textContent = 'WELKOM BY KRIPTIEK'; }
    }

    // Try localStorage first (your baseline persists userName there)
    const lsName = localStorage.getItem('userName') || localStorage.getItem('displayName');
    if(lsName) setWelcome(lsName);

    // Hardened Firebase Auth listener (only if Firebase is present on page)
    try {
      // Compatible with modular CDN build
      import('https://www.gstatic.com/firebasejs/10.12.4/firebase-app.js').then(async ({ initializeApp, getApps })=>{
        const { getAuth, onAuthStateChanged } = await import('https://www.gstatic.com/firebasejs/10.12.4/firebase-auth.js');

        // If your app is already initialised elsewhere, this won't re-init.
        const cfg = window.firebaseConfig || null;  // keep your existing config usage
        if(cfg && getApps().length === 0) initializeApp(cfg);

        const auth = getAuth();
        onAuthStateChanged(auth, (user)=>{
          if(user && user.uid){
            const n = (user.displayName || localStorage.getItem('userName') || '').trim();
            setWelcome(n || user.email?.split('@')[0] || 'SPELER');
            // Optional: hide any guest-only mounts if you still have them
            document.querySelectorAll('[data-guest-only]').forEach(el=>el.classList.add('hide'));
          }else{
            setWelcome(null);
          }
        });
      }).catch(()=>{/* ignore if firebase not used here */});
    } catch(e){ /* not critical for the homepage */ }

    // --- Cookie banner ---
    const cookieBanner = document.getElementById('cookieBanner');
    const cookieBtn = document.getElementById('cookieBtn');
    const COOKIE_KEY = 'kriptiek-cookie-ok';
    function refreshCookieBanner(){
      if(localStorage.getItem(COOKIE_KEY)==='1'){ cookieBanner.classList.add('hide'); }
    }
    cookieBtn.addEventListener('click', ()=>{ localStorage.setItem(COOKIE_KEY,'1'); refreshCookieBanner(); });
    refreshCookieBanner();

    // --- PWA install: use beforeinstallprompt if available; else go to help page ---
    let deferredPrompt = null;
    window.addEventListener('beforeinstallprompt', (e) => {
      e.preventDefault();
      deferredPrompt = e;
    });

    const appTile = document.getElementById('appTile');
    appTile.addEventListener('click', async (evt)=>{
      if(deferredPrompt){
        evt.preventDefault();
        deferredPrompt.prompt();
        deferredPrompt = null;
      }else{
        // Fallback: take users to your app help/download page
        // Change this to your preferred URL (e.g. /app, /install, direct .apk, etc.)
        // Default href on the <a> handles this already, so no action needed.
      }
    });
  </script>
</body>
</html>

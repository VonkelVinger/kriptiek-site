<!DOCTYPE html>
<html lang="af">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>Kriptiek Gesels</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Montserrat', sans-serif; background-color: #f9fafb; position: relative; }
    .background-crossword { position: absolute; top: 0; left: 0; width: 100%; height: 100%;
      display: grid; grid-template-columns: repeat(auto-fill, minmax(30px, 1fr));
      grid-template-rows: repeat(auto-fill, minmax(30px, 1fr)); opacity: 0.5; z-index: 1; pointer-events: none; }
    .bg-letter-box { display: flex; justify-content: center; align-items: center; font-size: 1.1rem; font-weight: bold;
      color: #9ca3af; border: 1px solid #e5e7eb; background-color: transparent; user-select: none; }
    .logo-container { position: relative; display: flex; justify-content: center; align-items: center; width: fit-content;
      margin: 1rem auto; padding: 1rem; border-radius: 1rem; background-color: white; overflow: hidden; }
    .crossword-grid { display: grid; grid-template-columns: repeat(8, minmax(40px, 1fr)); gap: 4px; position: relative; z-index: 10; }
    .letter-box { width: 50px; height: 50px; display: flex; justify-content: center; align-items: center; background-color: #374151; color: white;
      font-size: 1.8rem; font-weight: bold; border: 2px solid #1f2937; border-radius: 0.375rem; text-transform: uppercase; box-shadow: inset 0 0 5px rgba(0,0,0,.2); }
    .flipped-k { transform: scaleX(-1); }
    @media (max-width: 640px) { .letter-box { width: 38px; height: 38px; font-size: 1.2rem; } .crossword-grid { gap: 2px; } .logo-container { padding: 0.5rem; } }
    .tile { border-radius: .75rem; box-shadow: 0 6px 18px rgba(0,0,0,.08); }
    .btn { transition: .15s ease; }
    .btn:hover { transform: translateY(-1px); }
    .mono { font-family: ui-monospace, SFMono-Regular, Menlo, Monaco, Consolas, "Liberation Mono", "Courier New", monospace; }

    /* üîΩ Share dropdown */
    .share-wrap { position: relative; display: inline-block; }
    .share-menu { position: absolute; left: 0; top: 100%; margin-top: .5rem; width: 220px; background: #fff; border: 1px solid #e5e7eb;
      border-radius: .75rem; box-shadow: 0 8px 18px rgba(0,0,0,.12); overflow: hidden; z-index: 30; }
    .share-menu.hidden { display: none; }
    .share-head { background: #facc15; color: #1f2937; font-weight: 700; font-size: .65rem; letter-spacing: .02em; padding: .35rem .5rem; }
    .share-item { display: flex; align-items: center; gap:.5rem; width: 100%; text-align: left; padding: .6rem .7rem; font-size: .95rem; }
    .share-item:hover { background:#f9fafb; }
  </style>
</head>
<body class="relative">
  <header class="bg-white shadow p-4 text-center z-10 relative">
    <a href="/index.html" class="logo-container">
      <div id="backgroundCrossword" class="background-crossword"></div>
      <div class="crossword-grid">
        <div class="letter-box flipped-k">K</div><div class="letter-box flipped-k">R</div>
        <div class="letter-box">I</div><div class="letter-box flipped-k">P</div>
        <div class="letter-box">T</div><div class="letter-box">I</div>
        <div class="letter-box flipped-k">E</div><div class="letter-box">K</div>
      </div>
    </a>
    <h1 class="text-2xl font-bold text-gray-800 mt-2">GESELS SAAM, <span id="userDisplayName">BESOEKER</span></h1>
    <p class="text-sm text-gray-600">Spog, skinder of kla, maar gedra jou of jy word verwyder. Jy moet geregistreer wees om kommentaar te kan plaas.</p>
  </header>

  <main class="max-w-xl mx-auto p-6 relative z-10">

    <!-- üîù Nuttige skakels -->
    <section class="mb-6 p-4 bg-white border tile">
      <h2 class="text-lg font-semibold mb-2">üîó Nuttige skakels</h2>
      <ul class="space-y-1 text-sm text-gray-800">
        <li>üß© <a class="underline" href="/index.html">Kriptiek</a></li>
        <li>üå± <a class="underline" href="https://obsessie.wrintiewaar.co.za/" rel="nofollow">Obsessie</a> <span class="text-gray-500">(voorheen Wortel)</span></li>
        <li>üî† <a class="underline" href="https://www.nytimes.com/games/wordle/index.html" rel="nofollow">Wordle</a></li>
        <li>üïäÔ∏è <a class="underline" href="https://klyntji.com/watse" rel="nofollow">Watse</a></li>
        <li>ü™∂ <a class="underline" href="https://www.kwartel.io/#/" rel="nofollow">Kwartel</a></li>
      </ul>
      <p class="mt-3 text-sm">
        <a class="underline text-gray-800" href="/contact.html">üëâ Laat weet ons van ander raaisels of speletjies wat jy op di√© lys sou wou sien.</a>
      </p>
    </section>

    <!-- üßæ Deel-blok -->
    <section class="mb-6 p-4 bg-white border tile">
      <h2 class="text-lg font-semibold mb-1">üßæ Deel alles op een plek</h2>
      <p id="tplIntro" class="text-sm text-gray-700 mb-3"></p>

      <textarea id="scoreTemplate" rows="8" class="w-full p-2 border rounded mb-2 text-sm mono" placeholder="üìä My resultate vandag:

üü† Dilemma: ‚Äî
üü¢ Blitstiek: ‚Äî
üß† Slimstiek: ‚Äî
üå± Obsessie: ‚Äî
üá¨üáß Wordle: ‚Äî
üïäÔ∏è Watse: ‚Äî
ü™∂ Kwartel: ‚Äî

‚Äî kriptiek.com"></textarea>

      <div class="flex gap-2">
        <button id="copyTemplateBtn" class="btn bg-gray-800 hover:bg-black text-white px-3 py-2 rounded">Kopieer hierdie le√´ vorm</button>
      </div>
      <div id="tplMsg" class="text-xs text-gray-500 mt-2"></div>

      <div class="mt-4 text-xs text-gray-500">
        <ol class="list-decimal pl-5 space-y-1">
          <li>Kliek op ‚ÄúKopieer‚Äù om die le√´ vorm op jou knipbord te plaas.</li>
          <li>Plak die le√´ vorm dan met Ctrl-V in die boodskapveld van ‚Äôn nuwe plasing.</li>
          <li>Vul jou resultate in waar toepaslik, skryf ‚Äôn titel boaan en kliek <strong>STUUR</strong>.</li>
          <li>Los die vorm leeg waar jy niks wil deel nie. (En wees gereed om die volle resultate van enige afsonderlike raaisel of speletjie agterna apart te plaas as iemand dalk twyfel oor jou eerlikheid!)</li>
          <li>Kliek op <strong>DEEL</strong> (onder jou nuwe plasing) om die volle geplaaste boodskap met al jou resultate op jou knipbord te sit sodat jy dit op ander forums ook kan gaan plak as jy wil.</li>
        </ol>
      </div>
    </section>

    <!-- Composer -->
    <div id="new-post" class="mb-6">
      <h2 class="text-lg font-semibold mb-2">Jou nuwe plasing</h2>
      <input type="text" id="postTitle" maxlength="80" placeholder="Titel" class="w-full p-2 border rounded mb-2">
      <textarea id="postContent" maxlength="500" rows="4" placeholder="Tik jou boodskap (maks. 500 karakters)" class="w-full p-2 border rounded mb-1"></textarea>
      <div class="text-sm text-gray-500 mb-2"><span id="charCount">0</span>/500 karakters</div>
      <button id="submitBtn" class="bg-blue-600 text-white px-4 py-2 rounded hover:bg-blue-700 transition">Stuur</button>
      <p id="formMsg" class="text-sm text-red-600 mt-2"></p>
    </div>

    <div id="post-tools" class="mb-6 flex items-center justify-between gap-2">
      <input type="text" id="searchInput" placeholder="Soek titels of inhoud..." class="w-full p-2 border rounded" />
    </div>

    <div id="postsList">
      <h2 class="text-lg font-semibold mb-4">Onlangse gesprekke</h2>
      <div id="forumPosts"></div>
      <button id="loadMoreBtn" class="hidden mt-4 w-full text-center text-sm text-blue-700 hover:underline">Laai meer...</button>
    </div>
  </main>

  <footer class="bg-white shadow p-4 text-center text-sm text-gray-500 z-10 relative">
    &copy; 2025 Kriptiek. Alle regte voorbehou. |
    <a href="/index.html" class="underline">Tuis</a> |
    <a href="/profile.html" class="underline">My profiel</a> |
    <a href="/privacy.html" class="underline">Privaatheidsbeleid</a> |
    <a href="/terms.html" class="underline">Voorwaardes</a> |
    <a href="/faq.html" class="underline">Gereelde vrae</a> |
    <a href="/about.html" class="underline">Oor Kriptiek</a> |
    <a href="/contact.html" class="underline">Kontak ons</a>
  </footer>

  <!-- ============================== JS ============================== -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import {
      getFirestore, collection, addDoc, getDocs, serverTimestamp,
      query, orderBy, updateDoc, doc, deleteDoc, limit, startAfter,
      getDoc, setDoc, getCountFromServer
    } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDH-nVvGkdaheH7pvRHH0M9TbW2f98lMGQ",
      authDomain: "kriptiek-c9ea2.firebaseapp.com",
      projectId: "kriptiek-c9ea2",
      storageBucket: "kriptiek-c9ea2.appspot.com",
      messagingSenderId: "620450620939",
      appId: "1:620450620939:web:e93a18ac23b53b33db890e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    let currentUser = null;
    onAuthStateChanged(auth, (u) => {
      const wasNull = currentUser === null;
      currentUser = u;
      if (wasNull) loadPosts(true);
      document.getElementById("new-post").style.display =
        (localStorage.getItem("userRegistered") === "true" && !!currentUser) ? "block" : "none";
    });

    const postsRef = collection(db, "forumPosts");
    const userName = localStorage.getItem("userName") || "Anoniem";
    document.getElementById("userDisplayName").textContent = (localStorage.getItem("userName") || "BESOEKER");

    const postLimit = 5;
    let lastVisible = null;
    let allLoaded = false;

    function relativeTime(date) {
      const now = new Date();
      const seconds = Math.floor((now - date) / 1000);
      const days = Math.floor(seconds / 86400);

      if (days >= 30) {
        const options = { day:'2-digit', month:'long', year:'numeric', hour:'2-digit', minute:'2-digit' };
        return date.toLocaleString('af-ZA', options).replace(',', ' om');
      }
      if (seconds < 60) return "nou";
      const minutes = Math.floor(seconds / 60);
      if (minutes < 60) return `${minutes} minuut${minutes === 1 ? "" : "e"} gelede`;
      const hours = Math.floor(minutes / 60);
      if (hours < 24) return `${hours} uur gelede`;
      return `${days} dag${days === 1 ? "" : "e"} gelede`;
    }

    function applyFormatting(text) {
      return text.replace(/\*\*(.*?)\*\*/g, '<strong>$1</strong>')
                 .replace(/_(.*?)_/g, '<em>$1</em>')
                 .replace(/\n/g, "<br>");
    }

    // ---------- Template helpers ----------
    const tplArea = document.getElementById('scoreTemplate');
    const tplMsg = document.getElementById('tplMsg');
    const tplIntro = document.getElementById('tplIntro');

    // Dynamic date in instructions
    const todayStr = new Date().toLocaleDateString('af-ZA', { day: 'numeric', month: 'long', year: 'numeric' });
    tplIntro.textContent =
      `Gebruik hierdie vorm om al jou resultate vir ${todayStr} in een maklik leesbare formaat te plaas en dan te deel. S√≥ maak jy:`;

    async function copyToClipboard(text) {
      try { await navigator.clipboard.writeText(text); tplMsg.textContent = 'Gekopieer na knipbord.'; }
      catch { tplMsg.textContent = 'Kon nie kopieer nie. Selekteer en kopieer handmatig.'; }
      setTimeout(()=> tplMsg.textContent = '', 2500);
    }

    document.getElementById('copyTemplateBtn').addEventListener('click', () => {
      const text = (tplArea.value || tplArea.placeholder || '').trim();
      copyToClipboard(text);
      // mark that user intends a template post (for showing SHARE after submit)
      sessionStorage.setItem('intendTemplatePost', '1');
    });

    // ---------- Composer + posting ----------
    async function submitPost() {
      const title = document.getElementById('postTitle').value.trim();
      const content = document.getElementById('postContent').value.trim();
      const msg = document.getElementById('formMsg');

      if (!title || !content) {
        msg.textContent = 'Titel en boodskap is verpligtend.';
        return;
      }
      if (!currentUser) {
        msg.textContent = 'Jy moet aangemeld wees om te plaas.';
        return;
      }
      msg.textContent = '';

      const docRef = await addDoc(postsRef, {
        title, content, userName,
        authorId: currentUser.uid,
        timestamp: serverTimestamp()
      });

      // If user used the template flow, remember this post ID for SHARE tile
      if (sessionStorage.getItem('intendTemplatePost') === '1') {
        localStorage.setItem('lastTemplatePostId', docRef.id);
        sessionStorage.removeItem('intendTemplatePost');
      }

      document.getElementById('postTitle').value = '';
      document.getElementById('postContent').value = '';
      document.getElementById('charCount').textContent = '0';
      lastVisible = null;
      loadPosts(true);
    }

    async function loadReplies(postId) {
      const repliesBox = document.getElementById(`replies-${postId}`);
      if (!repliesBox) return;
      repliesBox.innerHTML = ``; // replies optional for MVP
    }

    async function refreshLikeUI(postId) {
      const countEl = document.getElementById(`like-count-${postId}`);
      const btn = document.querySelector(`.like-btn[data-id="${postId}"]`);
      try {
        const likesRef = collection(db, "forumPosts", postId, "likes");
        const agg = await getCountFromServer(query(likesRef));
        countEl.textContent = agg.data().count;
      } catch {
        const likesRef = collection(db, "forumPosts", postId, "likes");
        const snap = await getDocs(likesRef);
        countEl.textContent = snap.size;
      }
      if (currentUser) {
        const likeRef = doc(db, "forumPosts", postId, "likes", currentUser.uid);
        const likeDoc = await getDoc(likeRef);
        const already = likeDoc.exists();
        btn.disabled = already;
        btn.classList.toggle("opacity-50", already);
        btn.classList.toggle("cursor-not-allowed", already);
        btn.title = already ? "Jy het reeds gestem" : "Stem vir hierdie plasing";
      } else {
        btn.title = "Meld aan om te stem";
      }
    }

    function isTemplatedText(text) {
      if (!text) return false;
      const t = text.toLowerCase();
      const hasHeader = t.includes('üìä') || t.includes('my resultate');
      const tokens = ['dilemma:', 'blitstiek:', 'slimstiek:', 'obsessie:', 'wordle:', 'watse:', 'kwartel:'];
      const matches = tokens.reduce((n, k) => n + (t.includes(k) ? 1 : 0), 0);
      return hasHeader && matches >= 2; // at least two game lines
    }

    function sharePostPayload(title, content) {
      const header = 'S√≥ het ek vandag gevaar';
      const link = 'https://www.kriptiek.com/forum.html';
      return `${header}\n\n${title}\n\n${content}\n\n${link}`;
    }

    // Build the dropdown DOM for a given post
    function buildShareDropdown(docId, title, content) {
      const text = sharePostPayload(title, content);
      const encoded = encodeURIComponent(text);

      return `
        <div class="share-wrap">
          <button class="share-post-btn" data-id="${docId}" title="Deel">
            <img src="/assets/SHARE_12SEP.png" alt="DEEL" class="h-10 w-auto select-none" />
          </button>
          <div class="share-menu hidden" id="share-menu-${docId}">
            <div class="share-head">DEEL VIA</div>
            <button class="share-item share-wa" data-id="${docId}" data-text="${encoded}">
              <span>üì± WhatsApp</span>
            </button>
            <button class="share-item share-copy" data-id="${docId}" data-text="${encoded}">
              <span>üìã Kopieer skakel</span>
            </button>
            <button class="share-item share-system" data-id="${docId}" data-text="${encoded}">
              <span>üñ•Ô∏è Stelsel-deel</span>
            </button>
          </div>
        </div>`;
    }

    // Toggle helpers (close on outside click/scroll/resize)
    function closeAllShareMenus() {
      document.querySelectorAll('.share-menu').forEach(m => m.classList.add('hidden'));
    }
    document.addEventListener('click', (e) => {
      const inShare = e.target.closest('.share-wrap');
      if (!inShare) closeAllShareMenus();
    });
    window.addEventListener('scroll', closeAllShareMenus, { passive: true });
    window.addEventListener('resize', closeAllShareMenus);

    async function loadPosts(reset = false) {
      const container = document.getElementById("forumPosts");
      const searchTerm = document.getElementById("searchInput").value.trim().toLowerCase();
      const loadMoreBtn = document.getElementById("loadMoreBtn");

      if (reset) {
        container.innerHTML = "";
        lastVisible = null;
        allLoaded = false;
      }
      if (allLoaded) return;

      let qRef = query(postsRef, orderBy("timestamp", "desc"), limit(postLimit));
      if (lastVisible) qRef = query(postsRef, orderBy("timestamp", "desc"), startAfter(lastVisible), limit(postLimit));
      const snap = await getDocs(qRef);
      if (snap.empty) {
        loadMoreBtn.classList.add("hidden");
        allLoaded = true;
        return;
      }

      lastVisible = snap.docs[snap.docs.length - 1];
      loadMoreBtn.classList.remove("hidden");

      const recentTemplateId = localStorage.getItem('lastTemplatePostId');

      snap.forEach(docSnap => {
        const post = docSnap.data();
        if (searchTerm &&
            !post.title?.toLowerCase().includes(searchTerm) &&
            !post.content?.toLowerCase().includes(searchTerm)) return;

        const div = document.createElement("div");
        div.className = "mb-6 p-4 border rounded bg-white shadow";
        const initials = (post.userName || "??").slice(0, 2).toUpperCase();

        let ts = new Date();
        if (post.timestamp?.toDate) ts = post.timestamp.toDate();
        else if (typeof post.timestamp === "string") ts = new Date(post.timestamp);

        const canDelete = (post.authorId && currentUser && post.authorId === currentUser.uid)
                          || (!post.authorId && post.userName === userName);

        const templated = isTemplatedText(post.content || "") || (recentTemplateId === docSnap.id);

        div.innerHTML = `
          <div class="flex items-center justify-between mb-2">
            <div class="flex items-center gap-2">
              <div class="w-8 h-8 rounded-full bg-blue-700 text-white text-sm flex items-center justify-center font-bold">${initials}</div>
              <div class="text-xs text-gray-500">${post.userName} ‚Ä¢ ${relativeTime(ts)}</div>
            </div>
            <div class="flex items-center gap-3">
              ${canDelete ? `<button class="text-red-500 text-xs delete-btn" data-id="${docSnap.id}">Verwyder</button>` : ""}
            </div>
          </div>
          <h3 class="text-lg font-bold text-gray-800 mb-1">${post.title || ''}</h3>
          <p class="text-gray-700 whitespace-pre-line mb-3">${applyFormatting(post.content || '')}</p>

          <div class="flex items-center gap-4 text-sm text-gray-600 mb-2">
            <button class="like-btn flex items-center gap-1" data-id="${docSnap.id}">
              üëç <span class="like-count" id="like-count-${docSnap.id}">0</span>
            </button>
            <button class="reply-toggle" data-id="${docSnap.id}">üí¨ Reageer</button>
          </div>

          ${templated ? `
            <div class="mt-2">
              ${buildShareDropdown(docSnap.id, post.title || '', post.content || '')}
            </div>
          ` : ``}

          <div class="reply-box hidden mt-2" id="reply-${docSnap.id}">
            <textarea class="w-full p-2 border rounded mb-1 reply-input" rows="2" maxlength="300" placeholder="Jou antwoord..."></textarea>
            <button class="send-reply bg-blue-600 text-white px-2 py-1 rounded text-sm" data-id="${docSnap.id}">Stuur</button>
          </div>
          <div class="replies text-sm mt-2 space-y-1" id="replies-${docSnap.id}"></div>
        `;
        container.appendChild(div);

        // Wire up per-post actions
        loadReplies(docSnap.id);
        refreshLikeUI(docSnap.id);
      });

      // Clear highlight once visible at least once
      if (recentTemplateId) localStorage.removeItem('lastTemplatePostId');

      attachPostEvents();
    }

    function attachPostEvents() {
      document.querySelectorAll(".reply-toggle").forEach(btn => {
        btn.onclick = () => {
          const box = document.getElementById("reply-" + btn.dataset.id);
          box.classList.toggle("hidden");
        };
      });

      document.querySelectorAll(".send-reply").forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          const input = document.querySelector(`#reply-${id} .reply-input`);
          const content = (input.value || "").trim();
          if (!content) return;
          if (!currentUser) { alert("Jy moet aangemeld wees om te antwoord."); return; }

          await addDoc(collection(db, "forumPosts", id, "replies"), {
            authorId: currentUser.uid,
            userName,
            content,
            createdAt: serverTimestamp()
          });

          input.value = "";
          loadReplies(id);
        };
      });

      document.querySelectorAll(".like-btn").forEach(btn => {
        btn.onclick = async () => {
          const id = btn.dataset.id;
          if (!currentUser) { alert("Meld asseblief aan om te stem."); return; }
          try {
            const likeRef = doc(db, "forumPosts", id, "likes", currentUser.uid);
            await setDoc(likeRef, { createdAt: serverTimestamp(), userName });
          } finally {
            await refreshLikeUI(id);
          }
        };
      });

      document.querySelectorAll(".delete-btn").forEach(btn => {
        btn.onclick = async () => {
          if (confirm("Is jy seker jy wil hierdie plasing verwyder?")) {
            await deleteDoc(doc(db, "forumPosts", btn.dataset.id));
            loadPosts(true);
          }
        };
      });

      // üîΩ Share button + menu actions
      document.querySelectorAll(".share-post-btn").forEach(btn => {
        btn.onclick = () => {
          closeAllShareMenus();
          const menu = document.getElementById(`share-menu-${btn.dataset.id}`);
          if (menu) menu.classList.toggle('hidden');
        };
      });

      document.querySelectorAll(".share-wa").forEach(btn => {
        btn.onclick = (e) => {
          const text = decodeURIComponent(e.currentTarget.dataset.text || "");
          const url = `https://wa.me/?text=${encodeURIComponent(text)}`;
          window.open(url, '_blank');
          closeAllShareMenus();
        };
      });

      document.querySelectorAll(".share-copy").forEach(btn => {
        btn.onclick = async (e) => {
          const text = decodeURIComponent(e.currentTarget.dataset.text || "");
          try { await navigator.clipboard.writeText(text); alert('Gekopieer na knipbord.'); }
          catch { alert('Kon nie kopieer nie. Selekteer en kopieer handmatig.'); }
          closeAllShareMenus();
        };
      });

      document.querySelectorAll(".share-system").forEach(btn => {
        btn.onclick = async (e) => {
          const text = decodeURIComponent(e.currentTarget.dataset.text || "");
          if (navigator.share) {
            try { await navigator.share({ text }); } catch {}
          } else {
            try { await navigator.clipboard.writeText(text); alert('Gekopieer na knipbord.'); }
            catch { alert('Kon nie kopieer nie.'); }
          }
          closeAllShareMenus();
        };
      });
    }

    // Live counter + search wiring
    document.getElementById("postContent").addEventListener("input", e => {
      document.getElementById("charCount").textContent = e.target.value.length;
    });
    document.getElementById("submitBtn").addEventListener("click", submitPost);
    document.getElementById("loadMoreBtn").addEventListener("click", () => loadPosts());
    document.getElementById("searchInput").addEventListener("input", () => loadPosts(true));
    document.getElementById("searchInput").value = "";
    loadPosts(true);
  </script>

  <script>
    // Background crossword
    const backgroundCrossword = document.getElementById('backgroundCrossword');
    const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
    function getRandomLetter(){ return letters[Math.floor(Math.random()*letters.length)]; }
    function generateBackgroundGrid() {
      backgroundCrossword.innerHTML = '';
      const numRows = Math.ceil(backgroundCrossword.offsetHeight / 30);
      const numCols = Math.ceil(backgroundCrossword.offsetWidth / 30);
      const totalCells = (numRows * numCols) || 300;
      for (let i = 0; i < totalCells; i++) {
        const bgLetterBox = document.createElement('div');
        bgLetterBox.classList.add('bg-letter-box');
        bgLetterBox.textContent = getRandomLetter();
        backgroundCrossword.appendChild(bgLetterBox);
      }
    }
    generateBackgroundGrid();
    window.addEventListener('resize', generateBackgroundGrid);
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="af">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DILEMMA â€“ Kriptiek</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <style>
    /* ... (same CSS as before) ... */
  </style>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
<!-- ... (rest of body and modal markup remains unchanged) ... -->
<script type="module">
// ... (Firebase setup and game logic functions as already defined) ...

function buildEmojiGrid() {
  const emojiGrid = [];
  for (let r = 0; r <= currentRow; r++) {
    let line = "";
    for (let c = 0; c < gridCols; c++) {
      const tile = board[r][c];
      if (tile.classList.contains("correct")) line += "ðŸŸ©";
      else if (tile.classList.contains("present")) line += "ðŸŸ¨";
      else line += "â¬œ";
    }
    emojiGrid.push(line);
  }
  return emojiGrid.join("\n");
}

function gameCompleted(attempts) {
  gameOver = true;
  resultMsg.textContent = `Veels geluk, ${storedName}, jy het die woord in ${attempts} raaiskote gekry!`;
  modal.style.display = "flex";

  const emojiSummary = buildEmojiGrid();
  const displayLink = "www.kriptiek.com";
  const fullUrl = gameUrl;
  const message = `DILEMMA ${gameId.replace("Game", "")} ${attempts}/6\n${emojiSummary}\n${displayLink}`;

  shareBtn.onclick = () => {
    navigator.clipboard.writeText(message).then(() => {
      const link = document.createElement("a");
      link.href = fullUrl;
      link.target = "_blank";
      link.click();
    });
  };

  submitScore(attempts);
  lockoutMessage.style.display = "block";
}

function gameFailed() {
  gameOver = true;
  resultMsg.textContent = `Jammer, ${storedName}! Vandag se oplossing is ${targetWord}.`;
  modal.style.display = "flex";

  const emojiSummary = buildEmojiGrid();
  const displayLink = "www.kriptiek.com";
  const fullUrl = gameUrl;
  const message = `DILEMMA ${gameId.replace("Game", "")} X/6\n${emojiSummary}\n${displayLink}`;

  shareBtn.onclick = () => {
    navigator.clipboard.writeText(message).then(() => {
      const link = document.createElement("a");
      link.href = fullUrl;
      link.target = "_blank";
      link.click();
    });
  };

  submitScore(gridRows);
  lockoutMessage.style.display = "block";
}

closeBtn.onclick = () => modal.style.display = "none";

function keyHandler(e) {
  if (e.key === "Enter") handleEnter();
  else if (e.key === "Backspace") handleBackspace();
  else if (/^[a-zA-Z]$/.test(e.key)) handleKey(e.key.toUpperCase());
}

document.addEventListener("keydown", keyHandler);
await loadGameData();
createGrid();
createKeyboard();
await loadLeaderboard();
await checkDailyLimit();
</script>
</body>
</html>

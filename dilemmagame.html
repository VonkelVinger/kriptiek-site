<!DOCTYPE html>
<html lang="af">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>DILEMMA â€“ Kriptiek</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet">
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDH-nVvGkdaheH7pvRHH0M9TbW2f98lMGQ",
      authDomain: "kriptiek-c9ea2.firebaseapp.com",
      projectId: "kriptiek-c9ea2",
      storageBucket: "kriptiek-c9ea2.appspot.com",
      messagingSenderId: "620450620939",
      appId: "1:620450620939:web:e93a18ac23b53b33db890e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const params = new URLSearchParams(window.location.search);
    const gameId = params.get("gameId");
    const gameRef = doc(db, "games", gameId);

    const MAX_GUESSES = 6;
    let WORD = "";
    let guesses = [];
    let currentGuess = "";
    let clue = "";
    let date = "";

    async function fetchGame() {
      const docSnap = await getDoc(gameRef);
      if (!docSnap.exists()) {
        alert("Geen speletjie gevind vir " + gameId);
        return;
      }
      const data = docSnap.data();
      WORD = data.word.toUpperCase();
      clue = data.clue;
      date = data.date;
      initGame();
    }

    function initGame() {
      document.getElementById("dateDisplay").textContent = date;
      document.getElementById("clueDisplay").textContent = clue;
      guesses = JSON.parse(localStorage.getItem(gameId) || "[]");
      createGrid();
      createKeyboard();
      updateGrid();
    }

    function createGrid() {
      const grid = document.getElementById("grid");
      for (let i = 0; i < MAX_GUESSES; i++) {
        const row = document.createElement("div");
        row.className = "flex justify-center mb-1";
        for (let j = 0; j < WORD.length; j++) {
          const tile = document.createElement("div");
          tile.className = "tile";
          row.appendChild(tile);
        }
        grid.appendChild(row);
      }
    }

    function createKeyboard() {
      const layout = [[..."QWERTYUIOP"],[..."ASDFGHJKL"],["ENTER",..."ZXCVBNM","\u232b"]];
      const kb = document.getElementById("keyboard");
      layout.forEach(r => {
        const row = document.createElement("div");
        row.className = "flex justify-center mb-1 flex-wrap";
        r.forEach(k => {
          const b = document.createElement("button");
          b.textContent = k === "\u232b" ? "\u2190" : k;
          b.className = "keyboard-button";
          b.onclick = () => handleKey(k);
          row.appendChild(b);
        });
        kb.appendChild(row);
      });
    }

    function handleKey(k) {
      if (guesses.includes(WORD) || guesses.length >= MAX_GUESSES) return;
      if (k === "\u232b") currentGuess = currentGuess.slice(0, -1);
      else if (k === "ENTER") {
        if (currentGuess.length !== WORD.length) return;
        guesses.push(currentGuess);
        localStorage.setItem(gameId, JSON.stringify(guesses));
        checkGuess(currentGuess);
        currentGuess = "";
      } else if (/^[A-Z]$/.test(k) && currentGuess.length < WORD.length) {
        currentGuess += k;
      }
      updateGrid();
    }

    function updateGrid() {
      const grid = document.getElementById("grid").children;
      for (let i = 0; i < MAX_GUESSES; i++) {
        const row = grid[i].children;
        const guess = guesses[i] || "";
        for (let j = 0; j < WORD.length; j++) {
          const tile = row[j];
          const c = guess[j] || (i === guesses.length ? currentGuess[j] || "" : "");
          tile.textContent = c || "";
          tile.style.background = "#fff";
          tile.style.color = "#000";
          tile.style.border = "1px solid #374151";
          if (guess) {
            let color = "#6b7280";
            if (c === WORD[j]) color = "#15803d";
            else if (WORD.includes(c)) color = "#ea580c";
            tile.style.background = color;
            tile.style.color = "#fff";
            tile.style.border = `1px solid ${color}`;
          }
        }
      }
    }

    function checkGuess(g) {
      if (g === WORD) alert("KORREK!");
      else if (guesses.length >= MAX_GUESSES) alert("Jammer, probeer weer.");
    }

    document.addEventListener("keydown", e => {
      const k = e.key.toUpperCase();
      if (/^[A-Z]$/.test(k) || k === "ENTER" || k === "BACKSPACE")
        handleKey(k === "BACKSPACE" ? "\u232b" : k);
    });

    fetchGame();
  </script>
  <style>
    body { font-family: 'Montserrat', sans-serif; background-color: #f8f5f2; }
    .tile {
      width: 40px; height: 40px; display: flex; justify-content: center; align-items: center;
      font-weight: bold; font-size: 1.2rem; margin: 2px; background: #fff; border: 1px solid #374151; color: #000;
    }
    .keyboard-button {
      border: 2px solid #374151; color: #374151; font-weight: bold; padding: 0.5rem; margin: 0.2rem; background: white;
    }
    .keyboard-button:hover { background: #a5312f; color: white; cursor: pointer; }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">
  <header class="text-center mb-4">
    <div class="flex justify-center gap-1 mb-1">
      <div class="letter-box flipped-k">K</div>
      <div class="letter-box flipped-k">R</div>
      <div class="letter-box">I</div>
      <div class="letter-box flipped-k">P</div>
      <div class="letter-box">T</div>
      <div class="letter-box">I</div>
      <div class="letter-box flipped-k">E</div>
      <div class="letter-box">K</div>
    </div>
  </header>
  <main class="w-full max-w-md bg-white border-2 border-[#374151] p-6 shadow">
    <h2 class="text-xl font-bold text-center mb-2">ðŸ§© DILEMMA vir <span id="dateDisplay"></span></h2>
    <p id="clueDisplay" class="text-center text-gray-700 italic mb-4"></p>
    <div id="grid" class="mb-4"></div>
    <div id="keyboard" class="text-center overflow-x-auto max-w-full flex flex-wrap justify-center"></div>

    <section class="mt-6 text-sm text-gray-800">
      <h3 class="text-lg font-bold mb-2">Hoe om te speel</h3>
      <p class="mb-2">Jy het ses kanse om die woord te raai.</p>
      <p class="mb-2">Jy mag vir elke probeerslag enige letters in enige volgorde kies, maar elke raaiskoot moet dieselfde aantal letters hÃª as die woord waarna jy soek. Dit hoef nie ook 'n woord te vorm nie.</p>
      <p class="mb-2">Gebruik jou toetsbord of die een op die skerm om jou raaiskoot in te tik, dan ENTER.</p>
      <ul class="list-disc list-inside mt-4">
        <li><span class="text-green-700 font-semibold">GROEN</span>: Die letter is in die woord Ã©n in die regte posisie.</li>
        <li><span class="text-orange-600 font-semibold">ORANJE</span>: Die letter is in die woord, maar op 'n ander plek.</li>
        <li><span class="text-yellow-500 font-semibold">GEEL</span>: Die letter kom meer as een keer in die woord voor, maar is nie hier op die regte plek nie.</li>
        <li><span class="text-gray-600 font-semibold">GRYS</span>: Die letter is nie in die woord nie.</li>
      </ul>
    </section>
  </main>
</body>
</html>

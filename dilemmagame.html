<!DOCTYPE html>
<html lang="af">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>DILEMMA ‚Äì Kriptiek</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    body {
      font-family: 'Montserrat', sans-serif;
      background-color: #f8f5f2;
    }
    .rotate-warning {
      display: none;
      position: fixed;
      top: 0;
      left: 0;
      width: 100%;
      background: #f87171;
      color: white;
      font-weight: bold;
      text-align: center;
      padding: 0.75rem;
      z-index: 50;
    }
    @media (max-width: 768px) and (orientation: portrait) {
      .keyboard {
        transform: scale(0.85);
        transform-origin: top center;
      }
      .rotate-warning {
        display: block;
      }
    }
  </style>
</head>
<body class="min-h-screen flex flex-col items-center p-4">

  <div class="rotate-warning">
    üîÑ Draai jou foon horisontaal vir 'n beter speelervaring.
  </div>

  <!-- HEADER -->
  <header class="text-center mb-4">
    <h1 class="text-3xl font-bold text-slate-700">üß© Vandag se DILEMMA</h1>
    <p id="gameDate" class="text-gray-600"></p>
  </header>

  <!-- CLUE -->
  <section class="mb-4 text-center">
    <p id="crypticClue" class="text-lg text-slate-800 font-semibold"></p>
  </section>

  <!-- GAME GRID -->
  <div id="gameGrid" class="flex gap-2 justify-center mb-4"></div>

  <!-- KEYBOARD -->
  <div id="keyboard" class="keyboard space-y-2 mb-4"></div>

  <!-- FEEDBACK + NAME INPUT -->
  <div id="gameFeedback" class="text-center text-lg font-bold text-slate-700"></div>
  <div id="nameInputSection" class="hidden text-center mt-4">
    <input id="playerName" class="border p-2 rounded text-center" placeholder="Jou naam" maxlength="20" />
    <button id="submitScore" class="ml-2 px-4 py-2 bg-blue-700 text-white rounded">Dien in</button>
  </div>

  <!-- LEADERBOARD -->
  <section id="leaderboardSection" class="mt-6 w-full max-w-md">
    <h2 class="text-xl font-bold mb-2 text-center text-slate-700">üèÜ Beste Pogings</h2>
    <ul id="leaderboard" class="bg-white p-4 rounded shadow space-y-1"></ul>
  </section>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js';
    import { getFirestore, doc, getDoc, collection, addDoc, query, orderBy, limit, getDocs } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDH-nVvGkdaheH7pvRHH0M9TbW2f98lMGQ",
      authDomain: "kriptiek-c9ea2.firebaseapp.com",
      projectId: "kriptiek-c9ea2",
      storageBucket: "kriptiek-c9ea2.appspot.com",
      messagingSenderId: "620450620939",
      appId: "1:620450620939:web:e93a18ac23b53b33db890e"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);

    const urlParams = new URLSearchParams(window.location.search);
    const gameId = urlParams.get('gameId');
    const gameRef = doc(db, 'games', gameId);

    let targetWord = '';
    let guesses = [];

    async function loadGame() {
      const gameSnap = await getDoc(gameRef);
      if (!gameSnap.exists()) {
        document.getElementById('gameDate').textContent = 'Geen speletjie gevind nie';
        return;
      }

      const gameData = gameSnap.data();
      targetWord = gameData.word.toUpperCase();

      document.getElementById('gameDate').textContent = `Datum: ${gameData.date}`;
      document.getElementById('crypticClue').textContent = gameData.clue;
      buildGrid();
      buildKeyboard();
      loadLeaderboard();
    }

    function buildGrid() {
      const container = document.getElementById('gameGrid');
      container.innerHTML = '';
      for (let i = 0; i < targetWord.length; i++) {
        const box = document.createElement('div');
        box.className = 'w-10 h-10 border-2 border-slate-400 flex items-center justify-center text-xl font-bold bg-white';
        box.textContent = guesses[i] || '';
        container.appendChild(box);
      }
    }

    function buildKeyboard() {
      const keys = ["QWERTYUIOP", "ASDFGHJKL", "ENTERZXCVBNM‚å´"];
      const container = document.getElementById('keyboard');
      container.innerHTML = '';
      keys.forEach(row => {
        const rowEl = document.createElement('div');
        row.split('').forEach(key => {
          const btn = document.createElement('button');
          btn.textContent = key === '‚å´' ? 'DEL' : key;
          btn.className = 'bg-slate-700 text-white px-3 py-2 rounded mx-1';
          btn.onclick = () => handleKey(key);
          rowEl.appendChild(btn);
        });
        container.appendChild(rowEl);
      });
    }

    function handleKey(key) {
      if (key === 'ENTER') {
        if (guesses.join('') === targetWord) {
          document.getElementById('gameFeedback').textContent = 'üéâ Reg geraai!';
          document.getElementById('nameInputSection').classList.remove('hidden');
        } else {
          document.getElementById('gameFeedback').textContent = '‚ùå Probeer weer';
        }
        return;
      }
      if (key === '‚å´') {
        guesses.pop();
      } else if (guesses.length < targetWord.length) {
        guesses.push(key);
      }
      buildGrid();
    }

    async function loadLeaderboard() {
      const scoresRef = collection(db, `leaderboard/${gameId}/entries`);
      const q = query(scoresRef, orderBy('score'), limit(10));
      const snap = await getDocs(q);
      const list = document.getElementById('leaderboard');
      list.innerHTML = '';
      snap.forEach(doc => {
        const entry = doc.data();
        const li = document.createElement('li');
        li.textContent = `${entry.name} ‚Äì ${entry.score} letters`; 
        list.appendChild(li);
      });
    }

    document.getElementById('submitScore').onclick = async () => {
      const name = document.getElementById('playerName').value.trim();
      if (!name) return;
      const score = guesses.length;
      await addDoc(collection(db, `leaderboard/${gameId}/entries`), {
        name,
        score,
        timestamp: new Date().toISOString()
      });
      document.getElementById('nameInputSection').classList.add('hidden');
      loadLeaderboard();
    };

    loadGame();
  </script>
</body>
</html>

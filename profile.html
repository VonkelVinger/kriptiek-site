<!DOCTYPE html>
<html lang="af">
<head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S9V4CMP1FP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S9V4CMP1FP');
  </script>

    <!-- AdSense verification -->
  <script async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js?client=ca-pub-8199352351586797"
          crossorigin="anonymous"></script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>My Profiel – Kriptiek</title>

  <!-- Favicons -->
  <link rel="icon" href="/assets/favicon.ico?v=2" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png?v=3">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png?v=3">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png?v=3">
  <link rel="manifest" href="/assets/site.webmanifest?v=3">

  <!-- Fonts & Tailwind -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700;800;900&display=swap" rel="stylesheet">

  <style>
    body { font-family: 'Montserrat', sans-serif; background-color: #f3f4f6; }

    /* --- Header/logo styles --- */
    .logo-container { position: relative; display: flex; justify-content: center; align-items: center;
      width: fit-content; margin: 1rem auto; padding: 1rem; border-radius: 1rem; background-color: white; overflow: hidden; isolation: isolate; }
    .logo-container::before{ content:""; position:absolute; inset:-2px; border-radius:1rem;
      background:conic-gradient(from 180deg at 50% 50%, #1e3a8a, #334155, #1e3a8a);
      animation:spin 14s linear infinite; z-index:0; padding:2px;
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude; }
    @keyframes spin{ to{ transform:rotate(1turn); } }
    @media (prefers-reduced-motion: reduce){ .logo-container::before{ animation:none; } }

    .crossword-grid { display: grid; grid-template-columns: repeat(8, minmax(40px, 1fr)); gap: 4px; position: relative; z-index: 10; }
    .letter-box { width: 50px; height: 50px; display: flex; justify-content: center; align-items: center;
      background-color: #374151; color: white; font-size: 1.8rem; font-weight: bold; border: 2px solid #1f2937; border-radius: 0.375rem;
      text-transform: uppercase; box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2); }
    .flipped-k { transform: scaleX(-1); }

    .background-crossword { position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: grid;
      grid-template-columns: repeat(auto-fill, minmax(30px, 1fr)); grid-template-rows: repeat(auto-fill, minmax(30px, 1fr));
      opacity: 0.5; z-index: 1; pointer-events: none; animation: bgFloat 30s linear infinite; }
    @keyframes bgFloat{ 0%{ transform:translateY(0); } 50%{ transform:translateY(-12px); } 100%{ transform:translateY(0); } }

    .bg-letter-box { display: flex; justify-content: center; align-items: center; font-size: 1.1rem;
      font-weight: bold; color: #9ca3af; border: 1px solid #e5e7eb; background-color: transparent; user-select: none; }

    /* --- Card + pill styling --- */
    .card { background:#fff; border:1px solid #e5e7eb; border-radius:0.75rem; box-shadow:0 2px 6px rgba(2,6,23,.04); }
    .pill { display:inline-flex; align-items:center; border-radius:999px; padding:.35rem .9rem; font-weight:800; font-size:.9rem; }
    .pill-lg { padding:.45rem .95rem; font-size:1rem; }
    .pill-blue { background:#e0e7ff; color:#1e3a8a; }
    .pill-orange { background:#fff1e6; color:#c2410c; }
    .pill-green { background:#e8fff3; color:#065f46; }
    .pill-green-dark { background:#e6fffb; color:#115e59; }
    .mono { font-variant-numeric: tabular-nums; font-feature-settings: 'tnum' 1, 'lnum' 1; }
    .mini { background:#f8fafc; border:1px solid #e5e7eb; border-radius:.75rem; padding:.5rem .6rem; text-align:center; }
  </style>

  <!-- === Feature toggles === -->
  <script>
    const FEATURES = { blitstiek: true, slimstiek: false };
    function applyFeatureToggles() {
      const known = new Set(Object.keys(FEATURES));
      document.querySelectorAll('[data-section]').forEach(el => {
        const key = el.getAttribute('data-section');
        if (!known.has(key)) return;
        const on = !!FEATURES[key];
        el.style.display = on ? '' : 'none';
        el.setAttribute('aria-hidden', on ? 'false' : 'true');
      });
    }
    document.addEventListener('DOMContentLoaded', applyFeatureToggles);
  </script>
  <!-- Firebase setup -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth, onAuthStateChanged, sendPasswordResetEmail, deleteUser, updateProfile } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import {
      getFirestore, doc, getDoc, setDoc, updateDoc,
      collection, query, orderBy, limit, getDocs, serverTimestamp,
      collectionGroup, where, documentId
    } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDH-nVvGkdaheH7pvRHH0M9TbW2f98lMGQ",
      authDomain: "kriptiek-c9ea2.firebaseapp.com",
      projectId: "kriptiek-c9ea2",
      storageBucket: "kriptiek-c9ea2.appspot.com",
      messagingSenderId: "620450620939",
      appId: "1:620450620939:web:e93a18ac23b53b33db890e"
    };

    /* === DILEMMA scoring constants === */
    const BASE_POINTS = { 1:150, 2:135, 3:120, 4:110, 5:105, 6:100, fail:-50 };
    const STREAK_THRESHOLD = 5;
    const STREAK_MULTIPLIER = 1.10;
    const SUPPORTER_MULTIPLIER = 1.10;

    /* === Helpers === */
    function todayZaISO(){
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset()*60000;
      const za  = new Date(utc + 120*60000);
      return za.toISOString().slice(0,10);
    }
    function gameIdFor(daysFromToday){
      const now = new Date();
      const utc = now.getTime() + now.getTimezoneOffset()*60000;
      const za  = new Date(utc + 120*60000);
      za.setDate(za.getDate() + daysFromToday);
      return `Game${za.toISOString().slice(0,10)}`;
    }
    const GAME_TODAY = `Game${todayZaISO()}`;

    const $ = (id) => document.getElementById(id);
    const fmt = (n) => (typeof n === "number" ? n.toLocaleString("af-ZA") : n);

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    function setWbName(name){
      const el = $("wbName");
      if (el) el.textContent = (name || "Gebruiker").toUpperCase();
    }

    function getSupporterState(u){
      let active = false, untilTs = null;
      if (u?.supporterActive === true) active = true;
      if (u?.isPaid === true) active = true;

      const until =
        (u?.supporterUntil?.toMillis && u.supporterUntil.toMillis()) ||
        (typeof u?.supporterUntil === 'number' ? u.supporterUntil :
          (u?.supporterUntil ? Date.parse(u.supporterUntil) : null)) ||
        (typeof u?.paidUntil === 'number' ? u.paidUntil :
          (u?.paidUntil ? Date.parse(u.paidUntil) : null));

      if (Number.isFinite(until) && until > Date.now()) { active = true; untilTs = until; }
      return { active, untilTs };
    }

    /* === Dilemma scoring (overall + today) === */
    function computeDilemma(plays, supporterActive){
      const byDate = new Map();
      plays.slice().reverse().forEach(p => byDate.set(p.date, p));
      const dates = Array.from(byDate.keys()).sort();

      let cur = 0, prev = null;
      for (const d of dates) {
        const consec = prev && (new Date(d) - new Date(prev) === 24*60*60*1000);
        if (!consec) cur = 0;
        const p = byDate.get(d);
        if (p?.win) cur++; else cur = 0;
        prev = d;
      }

      const dist = {1:0,2:0,3:0,4:0,5:0,6:0,fail:0};
      for (const p of byDate.values()) {
        if (p.win) {
          const g = Math.min(Math.max(1, p.guesses || 6), 6);
          dist[g] += 1;
        } else dist.fail += 1;
      }

      const subtotal =
        dist[1]*BASE_POINTS[1] + dist[2]*BASE_POINTS[2] + dist[3]*BASE_POINTS[3] +
        dist[4]*BASE_POINTS[4] + dist[5]*BASE_POINTS[5] + dist[6]*BASE_POINTS[6] +
        dist.fail*BASE_POINTS.fail;

      const streakMult = (cur >= STREAK_THRESHOLD) ? STREAK_MULTIPLIER : 1;
      const supporterMult = supporterActive ? SUPPORTER_MULTIPLIER : 1;

      const streakBonus = Math.round(subtotal * (streakMult - 1));
      const overall = subtotal + streakBonus;
      const overallWithSupport = Math.round(overall * supporterMult);

      const today = byDate.get(todayZaISO());
      let todayPoints = null;
      if (today) {
        if (today.win) {
          const base = BASE_POINTS[Math.min(Math.max(1, today.guesses || 6), 6)];
          const baseWithStreak = Math.round(base * streakMult);
          todayPoints = Math.round(baseWithStreak * supporterMult);
        } else {
          todayPoints = BASE_POINTS.fail;
        }
      }

      return { overall: overallWithSupport, today: todayPoints };
    }

    async function loadDilemma(uid, supporterActive){
      const playsRef = collection(db, "userGames", uid, "plays");
      const q = query(playsRef, orderBy("finishedAt", "desc"), limit(200));
      const snap = await getDocs(q);

      const plays = [];
      snap.forEach(docSnap => {
        const d = docSnap.data();
        const gameId = docSnap.id; // "GameYYYY-MM-DD"
        const theDate = gameId.replace(/^Game/, "");
        plays.push({ date: theDate, win: d?.result === "win" || d?.finished === true, guesses: Number(d?.guesses || 0) });
      });

      return computeDilemma(plays, supporterActive);
    }
    /* === BLITSTIEK (instant tiers + confirmed history) === */

    // Parse milliseconds from possible shapes: timeMs number, time seconds, or "MM:SS"
    function parseBlitTimeMs(row){
      if (!row) return NaN;
      if (typeof row.timeMs === "number") return row.timeMs;
      if (typeof row.time === "number")   return row.time * 1000;
      if (typeof row.time === "string") {
        const parts = row.time.split(":").map(Number);
        if (parts.length === 2) return (parts[0]*60 + parts[1]) * 1000;
        if (parts.length === 1) return parts[0] * 1000;
      }
      return NaN;
    }

    // Instant bonus: <30s => 200, <60s => 100, else 0
    function blitInstantBonus(timeMs){
      if (!Number.isFinite(timeMs)) return 0;
      if (timeMs < 30000) return 200;
      if (timeMs < 60000) return 100;
      return 0;
    }

    // Resolve daily points from a leaderboard row (prefer canonical; infer instant if needed)
    function blitPointsFromRow(row){
      if (typeof row?.dailyPoints === "number") return row.dailyPoints; // canonical
      if (typeof row?.points === "number")      return row.points;      // legacy
      if (typeof row?.totalPoints === "number") return row.totalPoints; // legacy

      let p = 0;
      if (typeof row?.placePoints === "number") p += row.placePoints;   // legacy
      if (typeof row?.instant === "number")     p += row.instant;       // legacy
      p += blitInstantBonus(parseBlitTimeMs(row));                      // inference
      return p;
    }

    // Today tile: BEFORE 23:55 → instant only; AFTER 23:55 → instant + dailyPoints
    async function loadBlitstiekToday(uid, userDoc){
      // Try direct doc: id == uid
      let snap = await getDoc(doc(db, "blitstiekGames", GAME_TODAY, "leaderboard", uid));
      let row = snap.exists() ? { id: snap.id, ...snap.data() } : null;

      // Fallback: auto-ID with uid field
      if (!row) {
        try {
          const qs = await getDocs(query(
            collection(db, "blitstiekGames", GAME_TODAY, "leaderboard"),
            where("uid", "==", uid),
            limit(1)
          ));
          qs.forEach(d => { if (!row) row = { id: d.id, ...d.data() }; });
        } catch {}
      }

      const ms = parseBlitTimeMs(row);
      const instant = blitInstantBonus(ms);

      let place = null;
      if (row && typeof row.dailyPoints === "number") place = row.dailyPoints;
      if (typeof userDoc?.blit_todayPoints === "number") place = userDoc.blit_todayPoints;

      return { instant, place };
    }

    // Overall (Algeheel): confirmed history only — EXCLUDE today entirely
    async function loadBlitstiekOverall(userDoc, uid){
      const toNum = v => (typeof v === "number" ? v : (v==null ? 0 : Number(v)));

      // Prefer confirmed total maintained by the 23:55 job
      let base = toNum(
        userDoc?.blitstiekTotalConfirmed ??
        userDoc?.kBlit_total ??
        userDoc?.kBlitTotal ??
        userDoc?.blitstiekTotal ??
        userDoc?.blit_total
      );
      if (base) return base;

      // Recompute by summing past days (exclude GAME_TODAY)
      const todayId = GAME_TODAY;
      let sum = 0;

      try {
        const s1 = await getDocs(query(collectionGroup(db, "leaderboard"), where(documentId(), "==", uid), limit(365)));
        s1.forEach(d => {
          const parent = d.ref.parent.parent; const gameId = parent?.id || "";
          if (gameId !== todayId) sum += blitPointsFromRow(d.data());
        });
      } catch {}

      try {
        const s2 = await getDocs(query(collectionGroup(db, "leaderboard"), where("uid","==", uid), limit(365)));
        s2.forEach(d => {
          const parent = d.ref.parent.parent; const gameId = parent?.id || "";
          if (gameId !== todayId) sum += blitPointsFromRow(d.data());
        });
      } catch {}

      return sum;
    }

    /* === UI wiring === */
    function renderSupporterPill(state){
      const el=$("supporterPill"); if(!el) return;
      if(state.active){
        const extra = state.untilTs ? ` — tot ${new Date(state.untilTs).toLocaleDateString("af-ZA")}` : "";
        el.textContent = "ONDERSTEUNER: AKTIEF"+extra;
        el.style.background="#dcfce7"; el.style.color="#065f46"; el.style.border="1px solid #bbf7d0";
        el.classList.add("font-extrabold");
      }else{
        el.textContent="ONDERSTEUNER: NIE AKTIEF NIE";
        el.style.background="#fef2f2"; el.style.color="#991b1b"; el.style.border="1px solid #fecaca";
        el.classList.add("font-extrabold");
      }
    }

    function renderNumbers({kScore, dlmOverall, dlmToday, bltOverall, bltToday}){
      if ($("pillOverall"))       $("pillOverall").textContent       = `JOU KRIPTIEK-TELLING: ${fmt(kScore ?? 0)}`;
      if ($("pillDilemmaLive"))   $("pillDilemmaLive").textContent   = `JOU DILEMMA-TELLING: ${fmt(dlmOverall ?? 0)}`;
      if ($("pillBlitLive"))      $("pillBlitLive").textContent      = `JOU BLITSTIEK-TELLING: ${fmt(bltOverall ?? 0)}`;

      if ($("dilOverallScore"))   $("dilOverallScore").textContent   = fmt(dlmOverall ?? 0);
      if ($("calcTime"))          $("calcTime").textContent          = new Date().toLocaleString("af-ZA");
      if ($("totalPoints"))       $("totalPoints").textContent       = (dlmToday==null ? "—" : fmt(dlmToday));

      if ($("blitOverallScore"))  $("blitOverallScore").textContent  = fmt(bltOverall ?? 0);
      if ($("calcTimeBlit"))      $("calcTimeBlit").textContent      = new Date().toLocaleString("af-ZA");
      if ($("totalPointsBlit"))   $("totalPointsBlit").textContent   = (bltToday==null ? "—" : fmt(bltToday));
    }

    async function hydrateProfile(user){
      const nameEl  = $("nameInput");
      const emailEl = $("emailInput");
      if(nameEl)  nameEl.value  = user.displayName || "";
      if(emailEl) emailEl.value = user.email || "";

      // Ensure users doc exists
      const uref = doc(db, "users", user.uid);
      let userDocSnap = await getDoc(uref);
      if (!userDocSnap.exists()) {
        await setDoc(uref, { userName: user.displayName || "Gebruiker", createdAt: serverTimestamp(), updatedAt: serverTimestamp() }, { merge: true });
        userDocSnap = await getDoc(uref);
      }
      const userDoc = userDocSnap.data() || {};
      const supporter = getSupporterState(userDoc);
      renderSupporterPill(supporter);

      // Welcome name
      const displayName = user.displayName || userDoc.userName || "Gebruiker";
      setWbName(displayName);

      // Supporter banner
      const supporterBanner = document.getElementById("supporterBanner");
      if (supporterBanner) {
        if (supporter.active) {
          supporterBanner.className = "block text-center font-bold rounded-lg p-3 mb-4 bg-green-50 border border-green-200 text-green-800";
          supporterBanner.textContent = "Jy is 'n betalende ondersteuner — dankie!";
        } else {
          supporterBanner.className = "block text-center font-bold rounded-lg p-3 mb-4 bg-red-50 border border-red-200 text-red-800";
          supporterBanner.textContent = "Kliek hier om 'n betalende ondersteuner te word";
        }
      }

      // Blitstiek (historic confirmed + today instant-only until 23:55)
      const bltOverall = await loadBlitstiekOverall(userDoc, user.uid);
      const { instant: bltInstant, place: bltPlace } = await loadBlitstiekToday(user.uid, userDoc);
      let bltTodayTotal = null;
      if (bltPlace != null) bltTodayTotal = Number(bltInstant) + Number(bltPlace);
      else if (bltInstant)  bltTodayTotal = Number(bltInstant);

      const blitOverallUpdated = document.getElementById("blitOverallUpdated");
      if (blitOverallUpdated) blitOverallUpdated.textContent = new Date().toLocaleString("af-ZA");

      // Dilemma
      const { overall: dlmOverall, today: dlmToday } = await loadDilemma(user.uid, supporter.active);
      const upd = document.getElementById("dilOverallUpdated");
      if (upd) upd.textContent = new Date().toLocaleString("af-ZA");

      // Kriptiek total (Dilemma + Blitstiek)
      const kScore = Number(dlmOverall || 0) + Number(bltOverall || 0);

      renderNumbers({ kScore, dlmOverall, dlmToday, bltOverall, bltToday: bltTodayTotal });

      if (typeof gtag === 'function') gtag('event','profile_view',{ uid: user.uid });
    }

    function wireProfileForm(user){
      const form = $("profileForm");
      const resetBtn = $("resetPwBtn");
      const delBtn = $("deleteBtn");

      if(form){
        form.addEventListener("submit", async (e)=>{
          e.preventDefault();
          try{
            const newName = ($("nameInput").value||"").trim().slice(0,40);
            if(newName && newName !== (user.displayName||"")){
              await updateProfile(user, { displayName: newName });
              await updateDoc(doc(db,"users",user.uid), { userName: newName, updatedAt: serverTimestamp() });
              alert("Profiel gestoor.");
            } else {
              alert("Geen veranderinge om te stoor nie.");
            }
          }catch(err){ console.error(err); alert("Kon nie jou profiel opdateer nie."); }
        });
      }
      if(resetBtn){
        resetBtn.addEventListener("click", async ()=>{
          try{
            await sendPasswordResetEmail(auth, auth.currentUser.email);
            alert("’n Wagwoordherstel-skakel is per e-pos gestuur.");
          }catch(err){ console.error(err); alert("Kon nie wagwoordherstel stuur nie."); }
        });
      }
      if(delBtn){
        delBtn.addEventListener("click", async ()=>{
          if(!confirm("Is jy seker? Jou rekening sal verwyder word.")) return;
          try{
            await deleteUser(auth.currentUser);
            alert("Rekening verwyder.");
            window.location.href = "/";
          }catch(err){
            console.error(err);
            alert(String(err.code||"").includes("requires-recent-login")
              ? "Meld asseblief weer aan en probeer dan weer."
              : "Kon nie jou rekening verwyder nie.");
          }
        });
      }
    }

    // ---- Auth gate + bootstrap ----
    onAuthStateChanged(auth, async (user) => {
      if (!user) {
        const ret = encodeURIComponent("/profile.html");
        window.location.href = `/login.html?return=${ret}`;
        return;
      }
      try{
        await hydrateProfile(user);
        wireProfileForm(user);
      }catch(e){
        console.error(e);
      }
    });
  </script>
</head>
<body class="bg-gray-100 min-h-screen flex flex-col">
  <!-- Header -->
  <header class="bg-white shadow p-4">
    <div class="logo-container">
      <div id="backgroundCrossword" class="background-crossword"></div>
      <div class="crossword-grid">
        <div class="letter-box flipped-k">K</div>
        <div class="letter-box flipped-k">R</div>
        <div class="letter-box">I</div>
        <div class="letter-box flipped-k">P</div>
        <div class="letter-box">T</div>
        <div class="letter-box">I</div>
        <div class="letter-box flipped-k">E</div>
        <div class="letter-box">K</div>
      </div>
    </div>
  </header>

  <div class="max-w-6xl mx-auto px-4 pt-2 text-center text-2xl font-bold text-[#1e3a8a]">
    WELKOM TERUG, <span id="wbName">GEBRUIKER</span>
  </div>

  <main class="flex-grow p-4 pb-16">
    <div class="max-w-6xl mx-auto flex flex-col gap-6 items-stretch">

      <!-- PROFILE CARD -->
      <section class="card p-5 md:p-6">
        <a id="supporterBanner" href="https://buymeacoffee.com/kriptiek" target="_blank" rel="noopener"
           class="block text-center font-bold rounded-lg p-3 mb-4 bg-red-50 border border-red-200 text-red-800">
          Kliek hier om 'n betalende ondersteuner te word
        </a>

        <h2 class="text-lg font-bold mb-2">Profiel</h2>

        <form id="profileForm" class="space-y-4" novalidate>
          <div>
            <label for="nameInput" class="block text-sm font-semibold text-gray-700">Naam (kan ’n skuilnaam wees)</label>
            <input id="nameInput" type="text" minlength="2" maxlength="40" required class="mt-1 w-full border border-gray-300 rounded p-2" value="Speler"/>
          </div>
          <div>
            <label for="emailInput" class="block text-sm font-semibold text-gray-700">E-posadres</label>
            <input id="emailInput" type="email" required class="mt-1 w-full border border-gray-300 rounded p-2" value="speler@example.com" disabled/>
            <p class="text-xs text-slate-500 mt-1">Jou e-pos kan nie hier verander word nie.</p>
          </div>

          <div class="flex flex-wrap items-center gap-2">
            <button type="submit" class="px-4 py-2 rounded-xl bg-blue-900 text-white font-bold">BÊRE</button>
            <button id="resetPwBtn" type="button" class="px-4 py-2 rounded-xl bg-slate-800 text-white font-bold">VRA NUWE WAGWOORD</button>
            <button id="deleteBtn" type="button" class="px-4 py-2 rounded-xl bg-red-700 text-white font-bold">VERWYDER MY REKENING</button>
          </div>
        </form>
      </section>

      <!-- OVERVIEW -->
      <section class="card p-5 md:p-6">
        <div class="mb-2">
          <span id="supporterPill" class="pill pill-lg" style="background:#f1f5f9;color:#0f172a;border:1px solid #e2e8f0">ONDERSTEUNER: NIE AKTIEF NIE</span>
        </div>
        <div class="mb-4">
          <span id="pillOverall" class="pill pill-lg pill-blue">JOU KRIPTIEK-TELLING: 0</span>
        </div>
        <div class="flex flex-wrap gap-2 mb-4 items-start">
          <span id="pillDilemmaLive" class="pill pill-lg pill-orange">JOU DILEMMA-TELLING: 0</span>
          <span id="pillBlitLive" class="pill pill-lg pill-green">JOU BLITSTIEK-TELLING: 0</span>
          <span class="pill pill-lg pill-green-dark">JOU SLIMSTIEK-TELLING: BINNEKORT</span>
        </div>
        <p class="text-sm text-slate-600">
          Jou Kriptiek-telling is die som van jou <strong>Dilemma</strong>- en <strong>Blitstiek</strong>-tellings (Slimstiek volg later).
        </p>
      </section>

      <!-- DILEMMA -->
      <section class="card p-5 md:p-6" data-section="dilemma">
        <header class="flex flex-col gap-1 mb-3">
          <div class="h-1 w-full bg-orange-500 rounded-full"></div>
          <h2 class="text-xl font-extrabold text-slate-900">DILEMMA</h2>
        </header>

        <div class="rounded-xl border border-slate-200 bg-white p-4 mb-3">
          <div class="flex items-end justify-between">
            <div>
              <div id="dilOverallScore" class="text-6xl font-black mono text-slate-900 tracking-tight">0</div>
              <div class="text-xs uppercase tracking-wide text-slate-500">Algeheel (totaal)</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-slate-500">Laas opgedateer</div>
              <div id="dilOverallUpdated" class="text-sm mono">—</div>
            </div>
          </div>
        </div>

        <div class="rounded-xl border border-orange-200 bg-orange-50 p-4 mb-4">
          <div class="flex items-end justify-between">
            <div>
              <div id="totalPoints" class="text-4xl font-extrabold mono text-orange-900">—</div>
              <div class="text-xs uppercase tracking-wide text-orange-900/70">Vandag</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-orange-900/70">Laas bereken</div>
              <div id="calcTime" class="text-sm mono">—</div>
            </div>
          </div>
        </div>
      </section>

<div class="rounded-xl bg-gray-50 p-4 border border-gray-200 mt-3">
  <h3 class="font-semibold text-gray-800 mb-2">Dilemma: Telling & ranglys</h3>
  <ul class="list-disc list-inside text-gray-700 space-y-1">
    <li>Jy kry <strong>6 raaiskote</strong> om elke dag se Dilemma op te los.</li>
    <li>Hoe minder raaiskote jy nodig het, hoe meer punte kry jy.</li>
  </ul>

  <ul class="list-disc list-inside text-gray-700 space-y-1 ml-5">
    <li><strong>150 punte</strong> vir ’n oplossing in <strong>1 raaiskoot</strong></li>
    <li><strong>135 punte</strong> vir ’n oplossing in <strong>2 raaiskote</strong></li>
    <li><strong>120 punte</strong> vir ’n oplossing in <strong>3 raaiskote</strong></li>
    <li><strong>110 punte</strong> vir ’n oplossing in <strong>4 raaiskote</strong></li>
    <li><strong>105 punte</strong> vir ’n oplossing in <strong>5 raaiskote</strong></li>
    <li><strong>100 punte</strong> vir ’n oplossing in <strong>6 raaiskote</strong></li>
  </ul>

  <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
    <li>As jy nie die woord in ses raaiskote kry nie, <strong>verloor jy 50 punte</strong>.</li>
    <li>’n Lopie (ononderbroke sukses) van <strong>meer as 5 dae</strong> gee vir jou 'n <strong>10%-lopiebonus vir die dag</strong> 
        op al jou Dilemma-punte.</li>
    <li>Betalende Kriptiek-ondersteuners kry ’n <strong>10%-bonus</strong> 
        by hul totale Dilemma-telling.</li>
    <li>Jou <strong>algehele Dilemma-telling</strong> is die som van al jou vorige dae se tellings, 
        met lopie- en ondersteunerbonusse bygereken.</li>
  </ul>
</div>
      
      <!-- BLITSTIEK -->
      <section class="card p-5 md:p-6" data-section="blitstiek">
        <header class="flex flex-col gap-1 mb-3">
          <div class="h-1 w-full bg-emerald-500 rounded-full"></div>
          <h2 class="text-xl font-extrabold text-slate-900">BLITSTIEK</h2>
        </header>

        <div class="rounded-xl border border-slate-200 bg-white p-4 mb-3">
          <div class="flex items-end justify-between">
            <div>
              <div id="blitOverallScore" class="text-6xl font-black mono text-slate-900 tracking-tight">0</div>
              <div class="text-xs uppercase tracking-wide text-slate-500">Algeheel (totaal)</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-slate-500">Laas opgedateer</div>
              <div id="blitOverallUpdated" class="text-sm mono">—</div>
            </div>
          </div>
        </div>

        <div class="rounded-xl border border-emerald-200 bg-emerald-50 p-4 mb-3">
          <div class="flex items-end justify-between">
            <div>
              <div id="totalPointsBlit" class="text-4xl font-extrabold mono text-emerald-900">—</div>
              <div class="text-xs uppercase tracking-wide text-emerald-900/70">Vandag</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-emerald-900/70">Laas bereken</div>
              <div id="calcTimeBlit" class="text-sm mono">—</div>
            </div>
          </div>
        </div>

       <div class="rounded-xl bg-gray-50 p-4 border border-gray-200 mt-3">
  <h3 class="font-semibold text-gray-800 mb-2">Blitstiek: Telling & ranglys</h3>

  <ul class="list-disc list-inside text-gray-700 space-y-1">
    <li>Die ranglys wys <strong>die dag se 10 beste tye.</strong></li>
    <li>Jou naam verskyn hoogstens een keer op die dag se lys, en ’n beter tyd vervang jou vorige swakker tyd.</li>
  </ul>

  <ul class="list-disc list-inside text-gray-700 space-y-1 ml-5">
    <li><strong>200 punte</strong> vir ’n voltooiing in <strong>onder 30 sekondes</strong></li>
    <li><strong>100 punte</strong> vir ’n voltooiing in <strong>onder 60 sekondes</strong></li>
  </ul>

  <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
    <li>Jy kry <strong>bonuspunte vir jou posisie op die ranglys om 23:55</strong>:</li>
  </ul>

  <ul class="list-disc list-inside text-gray-700 space-y-1 ml-5">
    <li><strong>1ste plek</strong> – 200 punte</li>
    <li><strong>2de plek</strong> – 175 punte</li>
    <li><strong>3de plek</strong> – 150 punte</li>
    <li><strong>4de plek</strong> – 125 punte</li>
    <li><strong>5de plek</strong> – 100 punte</li>
    <li><strong>6de plek</strong> – 75 punte</li>
    <li><strong>7de plek</strong> – 50 punte</li>
    <li><strong>8ste plek</strong> – 40 punte</li>
    <li><strong>9de plek</strong> – 30 punte</li>
    <li><strong>10de plek</strong> – 20 punte</li>
  </ul>

  <ul class="list-disc list-inside text-gray-700 space-y-1 mt-2">
    <li>Betalende Kriptiek-ondersteuners kry ’n <strong>10%-bonus</strong> op die dag se ranglyspunte.</li>
    <li>Jou <strong>algehele Blitstiek-telling</strong> is die som van al jou vorige dae se bevestigde tellings, 
        met ondersteunerbonusse bygereken.</li>
  </ul>
</div>


      <!-- SLIMSTIEK (hidden for now) -->
      <section class="card p-5 md:p-6" data-section="slimstiek" aria-hidden="true" style="display:none">
        <header class="flex flex-col gap-1 mb-3">
          <div class="h-1 w-full bg-teal-500 rounded-full"></div>
          <h2 class="text-xl font-extrabold text-slate-900">SLIMSTIEK</h2>
        </header>

        <div class="rounded-xl border border-slate-200 bg-white p-4 mb-3">
          <div class="flex items-end justify-between">
            <div>
              <div id="slimOverallScore" class="text-6xl font-black mono text-slate-900 tracking-tight">0</div>
              <div class="text-xs uppercase tracking-wide text-slate-500">Algeheel (totaal)</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-slate-500">Laas opgedateer</div>
              <div id="slimOverallUpdated" class="text-sm mono">—</div>
            </div>
          </div>
        </div>

        <div class="rounded-xl border border-teal-200 bg-teal-50 p-4 mb-4">
          <div class="flex items-end justify-between">
            <div>
              <div id="totalPointsSlim" class="text-4xl font-extrabold mono text-teal-900">—</div>
              <div class="text-xs uppercase tracking-wide text-teal-900/70">Vandag</div>
            </div>
            <div class="text-right">
              <div class="text-xs text-teal-900/70">Laas bereken</div>
              <div id="calcTimeSlim" class="text-sm mono">—</div>
            </div>
          </div>
        </div>
      </section>

    </div>
  </main>

  <footer class="bg-white shadow p-4 text-center text-sm text-gray-500">
    &copy; 2025 Kriptiek. Alle regte voorbehou. |
    <a href="/index.html" class="underline">Tuis</a> |
    <a href="/forum.html" class="underline">Gesels saam</a> |
    <a href="/privacy.html" class="underline">Privaatheidsbeleid</a> |
    <a href="/terms.html" class="underline">Voorwaardes</a> |
    <a href="/faq.html" class="underline">Gereelde vrae</a> |
    <a href="/about.html" class="underline">Oor Kriptiek</a> |
    <a href="/contact.html" class="underline">Kontak ons</a>
  </footer>

  <!-- Background crossword init -->
  <script>
    document.addEventListener('DOMContentLoaded', function(){
      const bg = document.getElementById('backgroundCrossword'); if(!bg)return;
      const letters='ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const rand=()=>letters[Math.floor(Math.random()*letters.length)];
      function regen(){
        bg.innerHTML='';
        const rows=Math.ceil(bg.offsetHeight/30);
        const cols=Math.ceil(bg.offsetWidth/30);
        const total=(rows*cols)||300;
        for(let i=0;i<total;i++){
          const d=document.createElement('div');
          d.className='bg-letter-box';
          d.textContent=rand();
          bg.appendChild(d);
        }
      }
      regen();window.addEventListener('resize',regen);
    });
  </script>

</body>
</html>

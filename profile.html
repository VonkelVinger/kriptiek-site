<!DOCTYPE html>
<html lang="af">
<head>

  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S9V4CMP1FP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S9V4CMP1FP');
  </script>

  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>My Profiel – Kriptiek</title>

  <!-- Favicons -->
  <link rel="icon" href="/assets/favicon.ico?v=2" type="image/x-icon" />
  <link rel="icon" type="image/png" sizes="32x32" href="/assets/favicon-32x32.png?v=3">
  <link rel="icon" type="image/png" sizes="16x16" href="/assets/favicon-16x16.png?v=3">
  <link rel="apple-touch-icon" href="/assets/apple-touch-icon.png?v=3">
  <link rel="manifest" href="/assets/site.webmanifest?v=3">

  <!-- Styles -->
  <script src="https://cdn.tailwindcss.com"></script>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet" />
  <style>
    body { font-family: 'Montserrat', sans-serif; }
    .mono{ font-variant-numeric: tabular-nums; }

    .logo-container {
      position: relative; display: flex; justify-content: center; align-items: center;
      width: fit-content; margin: 1rem auto; padding: 1rem; border-radius: 1rem; background-color: white; overflow: hidden;
      isolation: isolate;
    }
    .logo-container::before{
      content:""; position:absolute; inset:-2px; border-radius:1rem;
      background:conic-gradient(from 180deg at 50% 50%, #1e3a8a, #334155, #1e3a8a);
      animation:spin 14s linear infinite; z-index:0; padding:2px;
      mask: linear-gradient(#000 0 0) content-box, linear-gradient(#000 0 0);
      -webkit-mask-composite: xor; mask-composite: exclude;
    }
    @keyframes spin{ to{ transform:rotate(1turn); } }
    @media (prefers-reduced-motion: reduce){ .logo-container::before{ animation:none; } }

    .crossword-grid { display: grid; grid-template-columns: repeat(8, minmax(40px, 1fr)); gap: 4px; position: relative; z-index: 10; }
    .letter-box {
      width: 50px; height: 50px; display: flex; justify-content: center; align-items: center;
      background-color: #374151; color: white; font-size: 1.8rem; font-weight: bold; border: 2px solid #1f2937; border-radius: 0.375rem;
      text-transform: uppercase; box-shadow: inset 0 0 5px rgba(0, 0, 0, 0.2);
    }
    .flipped-k { transform: scaleX(-1); }

    .background-crossword {
      position: absolute; top: 0; left: 0; width: 100%; height: 100%; display: grid;
      grid-template-columns: repeat(auto-fill, minmax(30px, 1fr)); grid-template-rows: repeat(auto-fill, minmax(30px, 1fr));
      opacity: 0.5; z-index: 1; pointer-events: none; animation: bgFloat 30s linear infinite;
    }
    @media (prefers-reduced-motion: reduce){ .background-crossword{ animation:none; } }
    @keyframes bgFloat{ 0%{ transform:translateY(0); } 50%{ transform:translateY(-12px); } 100%{ transform:translateY(0); } }

    .bg-letter-box { display: flex; justify-content: center; align-items: center; font-size: 1.1rem; font-weight: bold; color: #9ca3af; border: 1px solid #e5e7eb; background-color: transparent; user-select: none; }

    .kbtn{ display:inline-flex; align-items:center; justify-content:center; gap:.5rem; padding:.65rem 1rem; border-radius:.9rem; background:#1d4ed8; color:#fff; font-weight:800; box-shadow:0 10px 24px rgba(29,78,216,.25); }
    .kbtn:hover{ background:#1e40af; }
    .kbtn-red{ background:#dc2626; } .kbtn-red:hover{ background:#b91c1c; }

    .pill { display:inline-flex; align-items:center; gap:.6rem; padding:.6rem 1.1rem; border-radius:999px; font-weight:800; color:#fff; white-space:nowrap; line-height:1.15;
            box-shadow: 0 6px 14px rgba(0,0,0,.18), inset 0 1px 0 rgba(255,255,255,.25); }
    .pill-lg { font-size:1.15rem; padding:.75rem 1.25rem; }
    .pill-blue { background:linear-gradient(90deg,#1d4ed8,#1e40af); }
    .pill-orange { background: linear-gradient(180deg, #FB7A12 0%, #D65A0A 100%); }
    .pill-green { background: linear-gradient(180deg, #22C55E 0%, #0EA55B 100%); }
    .pill-green-dark { background: linear-gradient(180deg, #0F766E 0%, #065F46 100%); }

    .card{ background:#fff; border-radius:1rem; box-shadow:0 8px 18px rgba(0,0,0,.08); }
    .mini{ background:#f8fafc; border:1px solid #e5e7eb; border-radius:.75rem; padding:12px; text-align:center; }
    .summary-panel{ background:linear-gradient(180deg,#eef2ff 0%, #e0e7ff 100%); }
    .table{ width:100%; border-collapse:separate; border-spacing:0; }
    .table th,.table td{ padding:.55rem .75rem; border-bottom:1px solid #e5e7eb; }
    .table th{ text-align:left; font-weight:700; color:#334155; background:#f8fafc; }
    .table tbody tr:nth-child(even){ background:#f9fafb; }
    .barRow{ display:grid; grid-template-columns:1.1rem 1fr auto; gap:.5rem; align-items:center; }
    .barTrack{ height:12px; background:#e5e7eb; border-radius:6px; overflow:hidden; }
    .barFill{ height:100%; background:linear-gradient(90deg,#1d4ed8,#1e40af); }
  </style>
</head>

<body class="bg-gray-100 min-h-screen flex flex-col">
  <header class="bg-white shadow p-4">
    <div class="logo-container">
      <div id="backgroundCrossword" class="background-crossword"></div>
      <div class="crossword-grid">
        <div class="letter-box flipped-k">K</div><div class="letter-box flipped-k">R</div><div class="letter-box">I</div>
        <div class="letter-box flipped-k">P</div><div class="letter-box">T</div><div class="letter-box">I</div>
        <div class="letter-box flipped-k">E</div><div class="letter-box">K</div>
      </div>
    </div>
  </header>

  <div class="max-w-6xl mx-auto px-4 pt-2 text-center text-2xl font-bold text-[#1e3a8a]">
    WELKOM TERUG, <span id="wbName">GEBRUIKER</span>
  </div>

  <main class="flex-grow p-4 pb-16">
    <div class="max-w-6xl mx-auto grid md:grid-cols-2 gap-6 items-start">
      <!-- LEFT -->
      <section class="card p-5 md:p-6 top-card">
        <a id="supporterBanner" href="https://buymeacoffee.com/kriptiek" target="_blank" rel="noopener"
           class="supporter-banner supporter-banner-red mb-4"
           aria-label="Word ’n ondersteuner (Buy Me a Coffee)">
          <span id="supporterBannerTxt">Kliek hier om 'n betalende ondersteuner te word</span>
        </a>

        <h2 class="text-lg font-bold mb-2">Profiel</h2>
        <p id="errBanner" class="hidden text-sm mb-3 px-3 py-2 rounded bg-red-50 text-red-800" role="alert"></p>

        <form id="profileForm" class="space-y-4" novalidate>
          <div>
            <label for="nameInput" class="block text-sm font-semibold text-gray-700">Naam</label>
            <input id="nameInput" type="text" minlength="2" maxlength="40" required class="mt-1 w-full border border-gray-300 rounded p-2" value="Speler"/>
          </div>
          <div>
            <label for="emailInput" class="block text-sm font-semibold text-gray-700">E-posadres</label>
            <input id="emailInput" type="email" required class="mt-1 w-full border border-gray-300 rounded p-2" value="speler@example.com"/>
          </div>
          <div class="flex flex-wrap items-center gap-2">
            <button type="submit" class="kbtn" id="saveBtn">BÊRE</button>
            <button id="resetPwBtn" type="button" class="kbtn bg-slate-800 hover:bg-slate-900">VRA NUWE WAGWOORD</button>
            <button id="deleteBtn" type="button" class="kbtn kbtn-red">VERWYDER MY REKENING</button>
          </div>
        </form>
      </section>

      <!-- RIGHT -->
      <section class="card p-5 md:p-6 top-card">
        <div class="mb-4"><span id="pillOverall" class="pill pill-lg pill-blue">JOU KRIPTIEK-TELLING: 0</span></div>
        <div class="flex flex-wrap gap-2 mb-6 items-start">
          <span id="pillDilemmaLive" class="pill pill-lg pill-orange">JOU DILEMMA-TELLING: 0</span>
          <span class="pill pill-lg pill-green">JOU BLITSTIEK-TELLING: BINNEKORT</span>
          <span class="pill pill-lg pill-green-dark">JOU SLIMSTIEK-TELLING: BINNEKORT</span>
        </div>
        <p class="text-sm text-slate-600">
          Jou Kriptiek-telling is tans net vir Dilemma geaktiveer. Slimstiek en Blitstiek sal later bygevoeg word.
        </p>
      </section>
    </div>

    <div class="max-w-6xl mx-auto space-y-6 mt-6">
      <!-- DILEMMA stays fully active -->
      <section class="card p-5 md:p-6 game-card">
        <div class="flex items-center justify-between mb-3">
          <h2 class="text-xl font-extrabold text-slate-900">DILEMMA</h2>
          <span id="streakChip" class="hidden px-2.5 py-1 rounded-full font-bold text-indigo-900" style="background:#e0e7ff">+10% lopie</span>
        </div>
        <div id="dilemmaContent"><em>Laai tans jou Dilemma-statistiek...</em></div>
      </section>

      <!-- BLITSTIEK commented out -->
      <!--
      <section class="card p-5 md:p-6 game-card">
        ... Blitstiek section temporarily removed ...
      </section>
      -->

      <!-- SLIMSTIEK commented out -->
      <!--
      <section class="card p-5 md:p-6 game-card">
        ... Slimstiek section temporarily removed ...
      </section>
      -->
    </div>
  </main>

  <footer class="bg-white shadow p-4 text-center text-sm text-gray-500">
    &copy; 2025 Kriptiek. Alle regte voorbehou. |
    <a href="/index.html" class="underline px-1.5">Tuis</a> |
    <a href="/forum.html" class="underline px-1.5">Gesels saam</a>
  </footer>

  <script>
    document.addEventListener('DOMContentLoaded', function () {
      const backgroundCrossword = document.getElementById('backgroundCrossword');
      const letters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const rand = n => Math.floor(Math.random()*n);
      function getRandomLetter(){ return letters[rand(letters.length)]; }
      function generateBackgroundGrid() {
        if (!backgroundCrossword) return;
        backgroundCrossword.innerHTML = '';
        const numRows = Math.ceil(backgroundCrossword.offsetHeight / 30);
        const numCols = Math.ceil(backgroundCrossword.offsetWidth / 30);
        const totalCells = (numRows * numCols) || 300;
        for (let i = 0; i < totalCells; i++) {
          const bg = document.createElement('div');
          bg.className = 'bg-letter-box';
          bg.textContent = getRandomLetter();
          backgroundCrossword.appendChild(bg);
        }
      }
      generateBackgroundGrid();
      window.addEventListener('resize', ()=>generateBackgroundGrid());
    });
  </script>

  <!-- Firebase + guards -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js";
    import { getFirestore, doc, getDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyDH-nVvGkdaheH7pvRHH0M9TbW2f98lMGQ",
      authDomain: "kriptiek-c9ea2.firebaseapp.com",
      projectId: "kriptiek-c9ea2",
      storageBucket: "kriptiek-c9ea2.appspot.com",
      messagingSenderId: "620450620939",
      appId: "1:620450620939:web:e93a18ac23b53b33db890e"
    };
    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    onAuthStateChanged(auth, async (user)=>{
      if(!user){
        const ret = encodeURIComponent("/profile.html");
        window.location.href = `/login.html?return=${ret}`;
        return;
      }
      await hydrateProfile(user);
      await loadAndRenderDilemma(user.uid);
      configureGameBanners();
      if(document.getElementById("bannerBlit")) await renderShadowGame(user.uid,"blitstiek");
      if(document.getElementById("bannerSlim")) await renderShadowGame(user.uid,"slimstiek");
    });

    function configureGameBanners(){
      const bBlit=document.getElementById("bannerBlit");
      const bSlim=document.getElementById("bannerSlim");
      if(!bBlit && !bSlim) return;
      if(bBlit){ bBlit.classList.add("banner-archive"); bBlit.textContent="BLITSTIEK binnekort beskikbaar"; }
      if(bSlim){ bSlim.classList.add("banner-archive"); bSlim.textContent="SLIMSTIEK binnekort beskikbaar"; }
    }

    async function hydrateProfile(user){
      const wbName=document.getElementById("wbName");
      const snap=await getDoc(doc(db,"users",user.uid));
      const userName=(snap.exists() && snap.data().userName)||user.displayName||"Gebruiker";
      wbName.textContent=userName.toUpperCase();
    }

    async function loadAndRenderDilemma(uid){
      document.getElementById("dilemmaContent").innerHTML=
        "<p class='text-sm text-slate-600'>Jou Dilemma-statistiek sal binnekort hier verskyn.</p>";
    }

    async function renderShadowGame(){return;}
  </script>
</body>
</html>

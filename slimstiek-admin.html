<!DOCTYPE html>
<html lang="af">
<head>
  <!-- Google tag (gtag.js) -->
  <script async src="https://www.googletagmanager.com/gtag/js?id=G-S9V4CMP1FP"></script>
  <script>
    window.dataLayer = window.dataLayer || [];
    function gtag(){dataLayer.push(arguments);}
    gtag('js', new Date());
    gtag('config', 'G-S9V4CMP1FP');
  </script>

  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width,initial-scale=1">
  <title>SLIMSTIEK ADMIN – Kriptiek</title>
  <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;600&display=swap" rel="stylesheet">
  <script src="https://cdn.tailwindcss.com"></script>
  <style>
    body{font-family:'Montserrat',sans-serif}
    input,button{outline:none}
  </style>
</head>
<body class="bg-slate-50 text-slate-900 min-h-screen">

  <header class="bg-slate-900 text-white py-4">
    <h1 class="text-center text-2xl font-bold">SLIMSTIEK – ADMIN</h1>
  </header>

  <main class="max-w-lg mx-auto p-6">
    <p class="mb-4 text-sm text-slate-600">Gebruik hierdie paneel om die volgende dag se teikenwoord vir Slimstiek en Blitstiek te stel.</p>

    <label class="block mb-2 font-semibold text-slate-700">Datum (YYYY-MM-DD):</label>
    <input id="dateInput" type="date" class="w-full border border-slate-300 rounded-xl px-3 py-2 mb-4">

    <label class="block mb-2 font-semibold text-slate-700">Nuwe teikenwoord:</label>
    <input id="targetInput" type="text" maxlength="10" class="w-full border border-slate-300 rounded-xl px-3 py-2 uppercase mb-4">

    <div class="flex gap-2">
      <button id="saveSlimstiek" class="flex-1 bg-blue-700 hover:bg-blue-800 text-white font-semibold py-2 rounded-xl">Stel vir Slimstiek</button>
      <button id="saveBoth" class="flex-1 bg-green-700 hover:bg-green-800 text-white font-semibold py-2 rounded-xl">Stel vir Beide</button>
    </div>

    <p id="status" class="mt-4 text-sm text-slate-700"></p>
  </main>

  <!-- Firebase -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-app.js";
    import { getAuth, onAuthStateChanged } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-auth.js";
    import { getFirestore, doc, setDoc } from "https://www.gstatic.com/firebasejs/10.12.2/firebase-firestore.js";

    // use global config from your live site
    const app = initializeApp(window.firebaseConfig);
    const auth = getAuth(app);
    const db   = getFirestore(app);

    const status = document.getElementById('status');
    const dateInput = document.getElementById('dateInput');
    const targetInput = document.getElementById('targetInput');
    const saveSlimstiek = document.getElementById('saveSlimstiek');
    const saveBoth = document.getElementById('saveBoth');

    // default date = tomorrow in ZA
    const tz = 'Africa/Johannesburg';
    const now = new Date();
    const tomorrow = new Date(now.getTime() + 24*60*60*1000);
    dateInput.value = new Intl.DateTimeFormat('en-CA',{timeZone:tz,year:'numeric',month:'2-digit',day:'2-digit'}).format(tomorrow);

    function show(msg, ok=false){
      status.textContent = msg;
      status.className = ok ? "mt-4 text-green-700 font-semibold" : "mt-4 text-red-700 font-semibold";
    }

    async function saveWord(forBoth){
      const date = dateInput.value;
      const word = targetInput.value.trim().toUpperCase();
      if(!date || !word){show("Datum of woord ontbreek.");return;}
      const gid = "Game"+date;
      try{
        await setDoc(doc(db,"slimstiekGames",gid),{target:word,word:word,status:"active"},{merge:true});
        if(forBoth){
          await setDoc(doc(db,"blitstiekGames",gid),{target:word,word:word,status:"active"},{merge:true});
          show(`Teikenwoord "${word}" gestel vir Slimstiek én Blitstiek (${date}).`,true);
        }else{
          show(`Teikenwoord "${word}" gestel vir Slimstiek (${date}).`,true);
        }
      }catch(e){console.error(e);show("Kon nie skryf nie: "+e.message);}
    }

    saveSlimstiek.onclick = ()=>saveWord(false);
    saveBoth.onclick = ()=>saveWord(true);

    onAuthStateChanged(auth, user=>{
      if(!user){
        show("Meld asseblief aan as admin op Kriptiek.");
      }else{
        console.log("Signed in as:",user.email);
      }
    });
  </script>
</body>
</html>

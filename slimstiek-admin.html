<!DOCTYPE html><html lang="af"><head>
<meta charset="utf-8"/><meta name="viewport" content="width=device-width,initial-scale=1"/>
<title>SLIMSTIEK Admin – Kriptiek</title>
<script src="https://cdn.tailwindcss.com"></script>
<link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@500;700&display=swap" rel="stylesheet"/>
<style>body{font-family:'Montserrat',sans-serif;background:#f8f5f2}</style>
</head><body class="min-h-screen p-4">
  <main class="max-w-xl mx-auto bg-white rounded-xl shadow p-4">
    <h1 class="text-2xl font-bold mb-4">SLIMSTIEK: Stel dag se woord</h1>
    <label class="block mb-3">Datum (ZA):
      <input id="date" type="date" class="mt-1 w-full border rounded px-3 py-2"/>
    </label>
    <label class="block mb-3">Slimstiek woord:
      <input id="sword" type="text" maxlength="8" placeholder="bv. TUTS" class="mt-1 w-full border rounded px-3 py-2 uppercase"/>
    </label>
    <label class="inline-flex items-center gap-2 mb-4">
      <input id="copyBoth" type="checkbox" class="h-4 w-4">
      <span>Gebruik dieselfde woord vir Blitstiek</span>
    </label>
    <div class="flex gap-2">
      <button id="save" class="px-4 py-2 bg-green-700 text-white rounded font-bold">Stoor</button>
      <button id="load" class="px-4 py-2 bg-gray-700 text-white rounded font-bold">Laai</button>
    </div>
    <p id="msg" class="mt-3 text-sm text-gray-700"></p>
  </main>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js';
    import { getFirestore, doc, getDoc, setDoc, serverTimestamp } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js';
    import { getAuth, onAuthStateChanged } from 'https://www.gstatic.com/firebasejs/11.9.1/firebase-auth.js';

    const config={ apiKey:"AIzaSyDH-nVvGkdaheH7pvRHH0M9TbW2f98lMGQ", authDomain:"kriptiek-c9ea2.firebaseapp.com", projectId:"kriptiek-c9ea2", storageBucket:"kriptiek-c9ea2.appspot.com", messagingSenderId:"620450620939", appId:"1:620450620939:web:e93a18ac23b53b33db890e" };
    const app = initializeApp(config); const db = getFirestore(app); const auth=getAuth(app);

    const dateEl = document.getElementById('date');
    const swordEl= document.getElementById('sword');
    const bothEl = document.getElementById('copyBoth');
    const saveEl = document.getElementById('save');
    const loadEl = document.getElementById('load');
    const msgEl  = document.getElementById('msg');

    function todayKeySAST(){
      const parts = new Intl.DateTimeFormat('en-CA',{timeZone:'Africa/Johannesburg',year:'numeric',month:'2-digit',day:'2-digit'}).formatToParts(new Date());
      return `${parts.find(p=>p.type==='year').value}-${parts.find(p=>p.type==='month').value}-${parts.find(p=>p.type==='day').value}`;
    }
    dateEl.value = todayKeySAST();

    function normWord(v){ return (v||'').toUpperCase().replace(/[^A-Z]/g,'').slice(0,8); }

    onAuthStateChanged(auth, (u)=>{
      // Optional: gate by auth; tighten with security rules below.
      if(!u){ msgEl.textContent='Meld asseblief aan om te kan stoor.'; }
    });

    loadEl.onclick = async ()=>{
      msgEl.textContent='Laai...';
      const snap = await getDoc(doc(db,'daily_words', dateEl.value));
      if(!snap.exists()){ msgEl.textContent='Geen inskrywing vir dié datum nie.'; swordEl.value=''; return; }
      const d=snap.data()||{};
      swordEl.value = (d.slimstiek||d.word||'').toUpperCase();
      msgEl.textContent='Gelaai.';
    };

    saveEl.onclick = async ()=>{
      const date = dateEl.value;
      let w = normWord(swordEl.value);
      if(!/^[A-Z]{1,8}$/.test(w)){ msgEl.textContent='Gee ’n woord (A–Z, tot 8).'; return; }
      try{
        const payload = { slimstiek: w, updatedAt: serverTimestamp() };
        if(bothEl.checked){ payload.blitstiek = w; payload.word = w; }
        await setDoc(doc(db,'daily_words', date), payload, { merge:true });
        msgEl.textContent='Gestoor ✅';
      }catch(e){ msgEl.textContent='Kon nie stoor nie.'; console.warn(e); }
    };
  </script>
</body></html>
